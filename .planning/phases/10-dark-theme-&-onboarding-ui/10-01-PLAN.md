---
phase: 10-dark-theme-&-onboarding-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - index.html
autonomous: true

must_haves:
  truths:
    - "Application displays with dark podcast/audio editor theme by default"
    - "Dark theme has WCAG AA compliant contrast ratios (4.5:1 minimum)"
    - "Dark theme uses professional audio editor color palette (dark grays, muted accents)"
    - "Theme switches instantly on page load without FOUC (Flash of Unstyled Content)"
  artifacts:
    - path: "index.html"
      provides: "Inline FOUC prevention script in head"
      min_lines: 5
      pattern: "localStorage\\.getItem\\('theme'\\)"
    - path: "index.html"
      provides: "CSS Custom Properties defining dark theme palette"
      min_lines: 50
      pattern: "--bg-|--text-|--accent-"
    - path: "index.html"
      provides: "data-theme attribute selectors for dark mode"
      min_lines: 20
      pattern: "\\[data-theme=\"dark\"\\]"
  key_links:
    - from: "inline script"
      to: "document.documentElement"
      via: "setAttribute('data-theme')"
      pattern: "documentElement\\.setAttribute"
    - from: "CSS Custom Properties"
      to: "[data-theme] selectors"
      via: "variable references"
      pattern: "var\\(--"
---

<objective>
Implement professional dark podcast/audio editor theme with WCAG AA compliant contrast ratios and FOUC prevention.

Purpose: Establish visual foundation for v3.0 UX enhancements. Professional audio editors default to dark themes for eye strain reduction during long editing sessions. Dark theme must be stable before Phase 11 adds cut region highlighting (contrast validation required).

Output: Dark theme active by default with no flash on page load, following professional audio editor conventions (dark grays, muted accents).
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/research/SUMMARY.md
@.planning/research/STACK.md
@.planning/research/PITFALLS.md
@index.html
</context>

<tasks>

<task type="auto">
  <name>Add FOUC prevention script and refactor CSS to dark theme with Custom Properties</name>
  <files>index.html</files>
  <action>
    Add inline script in head BEFORE CSS to prevent FOUC:
    - Place script immediately after meta tags, before any styles
    - Read localStorage.getItem('theme')
    - Fallback to window.matchMedia('(prefers-color-scheme: dark)').matches
    - Set document.documentElement.setAttribute('data-theme', theme)
    - Default to 'dark' if no preference (professional audio editor convention)
    - Keep script under 0.5KB, use IIFE for isolation

    Refactor CSS section to use CSS Custom Properties:
    - Define :root variables for light theme (existing colors)
    - Define [data-theme="dark"] overrides with professional audio editor palette
    - Use dark grays for backgrounds (#1a1a1a body, #252525 cards, #2d2d2d panels)
    - Use muted blue accent (#4a9eff not bright #007bff)
    - Use warm amber for cut regions (#856404 bg, #ffc107 border - matches existing)
    - Replace all hardcoded color values with var(--variable-name) references
    - Ensure WCAG AA compliance: text contrast 4.5:1 minimum (body text #e0e0e0 on #1a1a1a = 10.4:1)

    Professional audio editor color palette (Audacity, Descript conventions):
    - Background primary: #1a1a1a (darkest - body)
    - Background secondary: #252525 (cards, containers)
    - Background tertiary: #2d2d2d (panels, sections)
    - Text primary: #e0e0e0 (high contrast body text)
    - Text secondary: #a0a0a0 (labels, metadata)
    - Text tertiary: #707070 (placeholders, disabled)
    - Accent primary: #4a9eff (muted blue - links, focus)
    - Accent success: #4ade80 (muted green - not bright lime)
    - Accent warning: #fbbf24 (amber - same as cut regions)
    - Accent danger: #f87171 (muted red - not bright)
    - Border color: #3d3d3d (subtle panel separation)
    - Input background: #333333 (slightly lighter than panels)

    Do NOT use bright saturated colors (eye strain in dark mode). Do NOT use pure black #000 (too harsh). Use prefers-color-scheme media query as fallback for first-time visitors.

    Why inline script (not external JS): Blocking synchronous execution prevents any rendering before theme is set. External scripts load asynchronously, causing FOUC.
  </action>
  <verify>
    Open index.html in browser:
    - Verify no white flash on page load
    - Verify dark theme active by default
    - Open DevTools > Accessibility > Contrast: verify all text meets 4.5:1 minimum
    - Check localStorage in DevTools > Application > Local Storage (should show theme: dark)
    - Test system preference override: DevTools > Rendering > Emulate prefers-color-scheme
    - Verify all UI sections use dark palette (file upload, player, transcript, cuts)
  </verify>
  <done>
    - Dark theme displays by default without FOUC
    - All hardcoded colors replaced with CSS Custom Properties
    - All text/background combinations meet WCAG AA 4.5:1 contrast
    - Theme persists to localStorage
    - Professional audio editor color palette applied (dark grays, muted accents)
    - prefers-color-scheme media query fallback working
  </done>
</task>

</tasks>

<verification>
Manual browser testing:
1. Hard refresh (Cmd/Ctrl+Shift+R) to bypass cache - verify no white flash
2. DevTools > Accessibility > Contrast - all text passes 4.5:1
3. DevTools > Application > Local Storage - theme key present
4. DevTools > Rendering > prefers-color-scheme dark - theme applies
5. Verify all sections dark: body, file upload panel, player controls, transcript, cut list, buttons, inputs
6. Check color palette matches professional audio editors (compare to Audacity/Descript if needed)
</verification>

<success_criteria>
- Application loads with dark theme active, no FOUC visible
- DevTools accessibility audit shows 0 contrast violations
- All UI elements use CSS Custom Properties (no hardcoded colors in element styles)
- localStorage stores theme preference
- Color palette follows professional audio editor conventions (dark grays #1a-2d range, muted accents)
- Theme applies before first paint (inline script executes synchronously)
</success_criteria>

<output>
After completion, create `.planning/phases/10-dark-theme-&-onboarding-ui/10-01-SUMMARY.md`
</output>
