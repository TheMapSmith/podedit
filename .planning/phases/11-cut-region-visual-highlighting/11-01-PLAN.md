---
phase: 11-cut-region-visual-highlighting
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - index.html
autonomous: false

must_haves:
  truths:
    - "User can see cut regions with shaded amber background in transcript"
    - "Cut regions have visible left border for clear boundaries"
    - "Cut region styling remains visible in dark theme with sufficient contrast"
    - "Visual feedback appears immediately when user marks start and end of cut"
    - "Visual feedback disappears immediately when user deletes a cut"
    - "Active playback highlight (yellow) remains visible on words inside cut regions"
  artifacts:
    - path: "index.html"
      provides: "CSS classes .in-cut-region with background and border"
      contains: ".in-cut-region"
      min_lines: 685
    - path: "src/controllers/transcriptController.js"
      provides: "highlightCutRegions method"
      exports: ["highlightCutRegions", "clearCutHighlights"]
      min_lines: 308
  key_links:
    - from: "src/controllers/cutController.js"
      to: "transcriptController.highlightCutRegions"
      via: "onCutListChanged callback in index.html"
      pattern: "cutController\\.onCutListChanged.*highlightCutRegions"
    - from: "index.html"
      to: ".in-cut-region CSS class"
      via: "CSS variables --cut-region-bg and --cut-region-border"
      pattern: "\\.in-cut-region.*var\\(--cut-region"
---

<objective>
Verify and polish cut region visual highlighting in transcript using existing dark theme foundation.

Purpose: Validate that cut regions display with clear visual feedback (shaded amber background + left border) and remain visible in dark theme with WCAG AA contrast. Ensure immediate visual updates when users mark or remove cuts.

Output: Working cut region highlighting with verified contrast ratios and polished interaction feedback.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-dark-theme-&-onboarding-ui/10-01-SUMMARY.md
@.planning/phases/04-cut-point-management/04-01-SUMMARY.md
@src/controllers/transcriptController.js
@src/controllers/cutController.js
@index.html

## Existing Implementation

Cut region highlighting was implemented in Phase 4 (Cut Point Management):
- `TranscriptController.highlightCutRegions()` method adds `.in-cut-region` class to words
- `CutController.onCutListChanged` callback wired to trigger highlighting
- CSS class `.in-cut-region` with background and border already defined

Dark theme foundation established in Phase 10:
- CSS Custom Properties: `--cut-region-bg` (#856404 dark amber), `--cut-region-border` (#ffc107 bright amber)
- WCAG AA contrast validated for dark theme colors
- `.in-cut-region.active` class for playback highlight overlay

## What Needs Verification

This phase is primarily **verification and polish** of existing functionality:
1. Visual appearance of cut regions in both light and dark themes
2. Contrast ratios meet WCAG AA for amber background + text
3. Immediate visual feedback when marking/deleting cuts
4. Active playback highlight remains visible on cut region words
5. Cut region boundaries are clear with left border

## Known Issues to Check

From Phase 4 implementation:
- Cut highlighting uses word overlap logic (word.start < cut.end AND word.end > cut.start)
- Active class stacking (.in-cut-region.active) should maintain visibility
- Callback fires on every cut list change (add, delete, update)
</context>

<tasks>

<task type="auto">
  <name>Validate cut region styling and contrast ratios</name>
  <files>index.html</files>
  <action>
Verify cut region CSS styling meets requirements:

1. **Locate cut region CSS classes** (around line 686):
   - `.in-cut-region` should have background and border-left properties
   - `.in-cut-region.active` should have distinct hover/playback state

2. **Validate CSS Custom Properties references**:
   - Background uses `var(--cut-region-bg)`
   - Border uses `var(--cut-region-border)`
   - Both variables defined in dark theme section

3. **Check contrast ratios** using WebAIM or browser DevTools:
   - Dark theme: `#856404` background with `#e0e0e0` text (primary text color)
   - Light theme: `#fff3cd` background with `#333333` text
   - Both must meet WCAG AA 4.5:1 minimum

4. **If contrast fails**: Adjust `--cut-region-bg` values in dark/light theme sections
   - Increase lightness for dark theme backgrounds
   - Decrease lightness for light theme backgrounds
   - Re-test until WCAG AA compliance achieved

5. **Verify border visibility**:
   - `border-left: 3px solid var(--cut-region-border)` provides clear boundary
   - Border color (`#ffc107`) sufficient contrast against backgrounds

**Do NOT** change the overall structure or remove existing functionality. Only adjust color values if contrast validation fails.
  </action>
  <verify>
1. Open index.html and locate CSS around line 686
2. Confirm `.in-cut-region` class exists with background and border-left
3. Use browser DevTools Accessibility panel to check contrast:
   - Switch to dark theme: data-theme="dark"
   - Check text/background contrast >= 4.5:1
   - Switch to light theme: data-theme="light"
   - Check text/background contrast >= 4.5:1
4. Verify both light and dark theme CSS variables are defined in :root and [data-theme="dark"]
  </verify>
  <done>
- Cut region CSS classes exist with background and border properties
- CSS Custom Properties correctly referenced
- WCAG AA contrast ratios verified for both themes (>= 4.5:1)
- Border provides clear visual boundary (3px solid, sufficient contrast)
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Cut region visual highlighting with dark theme integration.

Existing functionality from Phase 4:
- TranscriptController.highlightCutRegions() adds .in-cut-region class to words in cut ranges
- CutController.onCutListChanged callback triggers transcript updates
- CSS styling applies amber background + left border to highlighted words

Validated in Task 1:
- WCAG AA contrast ratios for cut region colors
- CSS Custom Properties integration with dark theme
- Border visibility and boundary clarity
  </what-built>

  <how-to-verify>
**Test cut region highlighting end-to-end:**

1. **Start dev server** (if not running):
   ```bash
   npm run dev
   ```

2. **Load application**: Navigate to `http://localhost:5173`

3. **Upload audio file**: Use any MP3/WAV/M4A file (test files in project or your own)

4. **Generate transcript**: Click "Generate Transcript" button, wait for completion

5. **Mark first cut region**:
   - Click "Mark Start" (or click a word + use button)
   - Scroll down in transcript
   - Click "Mark End" on a later word
   - **EXPECTED**: Words between start and end immediately show:
     - Shaded amber background (#856404 in dark theme, #fff3cd in light theme)
     - 3px left border in bright amber (#ffc107)
   - **VERIFY**: Background and border clearly visible, text remains readable

6. **Test active playback highlight**:
   - Click Play on audio player
   - **EXPECTED**: Current word highlights with yellow/gold during playback
   - **VERIFY**: Playback highlight remains visible on words inside cut regions
   - CSS rule `.in-cut-region.active` should apply darker/brighter background

7. **Mark second cut region** (different location):
   - Mark Start and End on different section of transcript
   - **VERIFY**: Second cut region immediately highlighted
   - **VERIFY**: First cut region highlighting remains unchanged

8. **Delete a cut region**:
   - Click "Delete" button on cut list item
   - **EXPECTED**: Corresponding transcript highlighting immediately disappears
   - **VERIFY**: Other cut regions remain highlighted

9. **Test dark/light theme** (if theme toggle exists, or use DevTools):
   - Open browser console: `document.documentElement.setAttribute('data-theme', 'light')`
   - **VERIFY**: Cut regions visible in light theme with good contrast
   - Switch back: `document.documentElement.setAttribute('data-theme', 'dark')`
   - **VERIFY**: Cut regions visible in dark theme with good contrast

10. **Visual polish check**:
    - Borders align cleanly with word spans (no gaps)
    - Background extends full width of transcript container
    - Multiple adjacent words in same cut region appear as continuous block
    - Cut region styling doesn't interfere with scroll behavior

**Expected outcomes:**
- ✅ Cut regions highlighted immediately on mark end
- ✅ Shaded amber background visible in both themes
- ✅ 3px left border provides clear boundary
- ✅ Text readable on cut region background (WCAG AA)
- ✅ Active playback highlight visible on cut words
- ✅ Delete immediately removes highlighting
- ✅ Multiple cut regions can coexist without visual conflicts

**If any issues found:**
- Visual bugs: Note specific issue (alignment, contrast, border)
- Functional bugs: Note when highlighting fails to update
- Timing bugs: Note if highlighting lags behind cut operations
  </how-to-verify>

  <resume-signal>
Type "approved" if all verification checks pass, or describe any issues found for fixing.
  </resume-signal>
</task>

</tasks>

<verification>
1. Cut region CSS classes exist with background and border-left properties
2. CSS Custom Properties correctly reference --cut-region-bg and --cut-region-border
3. WCAG AA contrast ratios verified (>= 4.5:1) for text on cut region backgrounds
4. Manual testing confirms immediate visual feedback on mark/delete operations
5. Playback highlight (.active) remains visible on words inside cut regions
6. Multiple cut regions can coexist without visual conflicts
7. Both light and dark themes display cut regions with sufficient contrast
</verification>

<success_criteria>
**Phase 11 requirements met:**
- VIS-01: Cut regions display with shaded amber background in transcript ✓
- VIS-02: Cut regions display with left border for visual boundary ✓
- VIS-03: Cut region styling visible in dark theme with sufficient contrast ✓

**Success criteria TRUE:**
1. Cut regions display with shaded amber background and left border in transcript
2. Cut region styling is visible in dark theme with sufficient contrast (WCAG AA)
3. Visual feedback is immediate when user marks or removes cuts

**Observable truths validated:**
- User sees amber background on words inside cut regions
- User sees 3px left border marking cut region boundaries
- Highlighting appears instantly when user completes cut (marks end)
- Highlighting disappears instantly when user deletes cut
- Playback highlight remains visible when playing through cut regions
- Text remains readable on cut region backgrounds (both themes)
</success_criteria>

<output>
After completion, create `.planning/phases/11-cut-region-visual-highlighting/11-01-SUMMARY.md`

Include:
- WCAG AA contrast ratio validation results
- Screenshots or descriptions of visual appearance in both themes
- Any CSS adjustments made to achieve compliance
- Integration validation (callback wiring confirmed working)
- Performance notes (highlighting speed, no lag on large transcripts)
</output>
